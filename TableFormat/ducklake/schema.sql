-- ============================================================================
-- ELECTRICITY DATA PIPELINE - TABLE DEFINITIONS
-- ============================================================================
-- This file contains all table DDL for the electricity data pipeline.
-- Tables use IF NOT EXISTS for idempotent execution.
-- ============================================================================

-- ----------------------------------------------------------------------------
-- HISTORICAL SCADA DATA (Daily Reports)
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS scada (
  UNIT VARCHAR,
  DUID VARCHAR,
  VERSION DOUBLE,
  RUNNO DOUBLE,
  INTERVENTION DOUBLE,
  DISPATCHMODE DOUBLE,
  AGCSTATUS DOUBLE,
  INITIALMW DOUBLE,
  TOTALCLEARED DOUBLE,
  RAMPDOWNRATE DOUBLE,
  RAMPUPRATE DOUBLE,
  LOWER5MIN DOUBLE,
  LOWER60SEC DOUBLE,
  LOWER6SEC DOUBLE,
  RAISE5MIN DOUBLE,
  RAISE60SEC DOUBLE,
  RAISE6SEC DOUBLE,
  MARGINAL5MINVALUE DOUBLE,
  MARGINAL60SECVALUE DOUBLE,
  MARGINAL6SECVALUE DOUBLE,
  MARGINALVALUE DOUBLE,
  VIOLATION5MINDEGREE DOUBLE,
  VIOLATION60SECDEGREE DOUBLE,
  VIOLATION6SECDEGREE DOUBLE,
  VIOLATIONDEGREE DOUBLE,
  LOWERREG DOUBLE,
  RAISEREG DOUBLE,
  AVAILABILITY DOUBLE,
  RAISE6SECFLAGS DOUBLE,
  RAISE60SECFLAGS DOUBLE,
  RAISE5MINFLAGS DOUBLE,
  RAISEREGFLAGS DOUBLE,
  LOWER6SECFLAGS DOUBLE,
  LOWER60SECFLAGS DOUBLE,
  LOWER5MINFLAGS DOUBLE,
  LOWERREGFLAGS DOUBLE,
  RAISEREGAVAILABILITY DOUBLE,
  RAISEREGENABLEMENTMAX DOUBLE,
  RAISEREGENABLEMENTMIN DOUBLE,
  LOWERREGAVAILABILITY DOUBLE,
  LOWERREGENABLEMENTMAX DOUBLE,
  LOWERREGENABLEMENTMIN DOUBLE,
  RAISE6SECACTUALAVAILABILITY DOUBLE,
  RAISE60SECACTUALAVAILABILITY DOUBLE,
  RAISE5MINACTUALAVAILABILITY DOUBLE,
  RAISEREGACTUALAVAILABILITY DOUBLE,
  LOWER6SECACTUALAVAILABILITY DOUBLE,
  LOWER60SECACTUALAVAILABILITY DOUBLE,
  LOWER5MINACTUALAVAILABILITY DOUBLE,
  LOWERREGACTUALAVAILABILITY DOUBLE,
  file VARCHAR,
  SETTLEMENTDATE TIMESTAMP,
  DATE DATE,
  YEAR INT
);

-- ----------------------------------------------------------------------------
-- HISTORICAL PRICE DATA (Daily Reports)
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS price (
  UNIT VARCHAR,
  REGIONID VARCHAR,
  VERSION DOUBLE,
  RUNNO DOUBLE,
  INTERVENTION DOUBLE,
  RRP DOUBLE,
  EEP DOUBLE,
  ROP DOUBLE,
  APCFLAG DOUBLE,
  MARKETSUSPENDEDFLAG DOUBLE,
  TOTALDEMAND DOUBLE,
  DEMANDFORECAST DOUBLE,
  DISPATCHABLEGENERATION DOUBLE,
  DISPATCHABLELOAD DOUBLE,
  NETINTERCHANGE DOUBLE,
  EXCESSGENERATION DOUBLE,
  LOWER5MINDISPATCH DOUBLE,
  LOWER5MINIMPORT DOUBLE,
  LOWER5MINLOCALDISPATCH DOUBLE,
  LOWER5MINLOCALPRICE DOUBLE,
  LOWER5MINLOCALREQ DOUBLE,
  LOWER5MINPRICE DOUBLE,
  LOWER5MINREQ DOUBLE,
  LOWER5MINSUPPLYPRICE DOUBLE,
  LOWER60SECDISPATCH DOUBLE,
  LOWER60SECIMPORT DOUBLE,
  LOWER60SECLOCALDISPATCH DOUBLE,
  LOWER60SECLOCALPRICE DOUBLE,
  LOWER60SECLOCALREQ DOUBLE,
  LOWER60SECPRICE DOUBLE,
  LOWER60SECREQ DOUBLE,
  LOWER60SECSUPPLYPRICE DOUBLE,
  LOWER6SECDISPATCH DOUBLE,
  LOWER6SECIMPORT DOUBLE,
  LOWER6SECLOCALDISPATCH DOUBLE,
  LOWER6SECLOCALPRICE DOUBLE,
  LOWER6SECLOCALREQ DOUBLE,
  LOWER6SECPRICE DOUBLE,
  LOWER6SECREQ DOUBLE,
  LOWER6SECSUPPLYPRICE DOUBLE,
  RAISE5MINDISPATCH DOUBLE,
  RAISE5MINIMPORT DOUBLE,
  RAISE5MINLOCALDISPATCH DOUBLE,
  RAISE5MINLOCALPRICE DOUBLE,
  RAISE5MINLOCALREQ DOUBLE,
  RAISE5MINPRICE DOUBLE,
  RAISE5MINREQ DOUBLE,
  RAISE5MINSUPPLYPRICE DOUBLE,
  RAISE60SECDISPATCH DOUBLE,
  RAISE60SECIMPORT DOUBLE,
  RAISE60SECLOCALDISPATCH DOUBLE,
  RAISE60SECLOCALPRICE DOUBLE,
  RAISE60SECLOCALREQ DOUBLE,
  RAISE60SECPRICE DOUBLE,
  RAISE60SECREQ DOUBLE,
  RAISE60SECSUPPLYPRICE DOUBLE,
  RAISE6SECDISPATCH DOUBLE,
  RAISE6SECIMPORT DOUBLE,
  RAISE6SECLOCALDISPATCH DOUBLE,
  RAISE6SECLOCALPRICE DOUBLE,
  RAISE6SECLOCALREQ DOUBLE,
  RAISE6SECPRICE DOUBLE,
  RAISE6SECREQ DOUBLE,
  RAISE6SECSUPPLYPRICE DOUBLE,
  AGGREGATEDISPATCHERROR DOUBLE,
  AVAILABLEGENERATION DOUBLE,
  AVAILABLELOAD DOUBLE,
  INITIALSUPPLY DOUBLE,
  CLEAREDSUPPLY DOUBLE,
  LOWERREGIMPORT DOUBLE,
  LOWERREGLOCALDISPATCH DOUBLE,
  LOWERREGLOCALREQ DOUBLE,
  LOWERREGREQ DOUBLE,
  RAISEREGIMPORT DOUBLE,
  RAISEREGLOCALDISPATCH DOUBLE,
  RAISEREGLOCALREQ DOUBLE,
  RAISEREGREQ DOUBLE,
  RAISE5MINLOCALVIOLATION DOUBLE,
  RAISEREGLOCALVIOLATION DOUBLE,
  RAISE60SECLOCALVIOLATION DOUBLE,
  RAISE6SECLOCALVIOLATION DOUBLE,
  LOWER5MINLOCALVIOLATION DOUBLE,
  LOWERREGLOCALVIOLATION DOUBLE,
  LOWER60SECLOCALVIOLATION DOUBLE,
  LOWER6SECLOCALVIOLATION DOUBLE,
  RAISE5MINVIOLATION DOUBLE,
  RAISEREGVIOLATION DOUBLE,
  RAISE60SECVIOLATION DOUBLE,
  RAISE6SECVIOLATION DOUBLE,
  LOWER5MINVIOLATION DOUBLE,
  LOWERREGVIOLATION DOUBLE,
  LOWER60SECVIOLATION DOUBLE,
  LOWER6SECVIOLATION DOUBLE,
  RAISE6SECRRP DOUBLE,
  RAISE6SECROP DOUBLE,
  RAISE6SECAPCFLAG DOUBLE,
  RAISE60SECRRP DOUBLE,
  RAISE60SECROP DOUBLE,
  RAISE60SECAPCFLAG DOUBLE,
  RAISE5MINRRP DOUBLE,
  RAISE5MINROP DOUBLE,
  RAISE5MINAPCFLAG DOUBLE,
  RAISEREGRRP DOUBLE,
  RAISEREGROP DOUBLE,
  RAISEREGAPCFLAG DOUBLE,
  LOWER6SECRRP DOUBLE,
  LOWER6SECROP DOUBLE,
  LOWER6SECAPCFLAG DOUBLE,
  LOWER60SECRRP DOUBLE,
  LOWER60SECROP DOUBLE,
  LOWER60SECAPCFLAG DOUBLE,
  LOWER5MINRRP DOUBLE,
  LOWER5MINROP DOUBLE,
  LOWER5MINAPCFLAG DOUBLE,
  LOWERREGRRP DOUBLE,
  LOWERREGROP DOUBLE,
  LOWERREGAPCFLAG DOUBLE,
  RAISE6SECACTUALAVAILABILITY DOUBLE,
  RAISE60SECACTUALAVAILABILITY DOUBLE,
  RAISE5MINACTUALAVAILABILITY DOUBLE,
  RAISEREGACTUALAVAILABILITY DOUBLE,
  LOWER6SECACTUALAVAILABILITY DOUBLE,
  LOWER60SECACTUALAVAILABILITY DOUBLE,
  LOWER5MINACTUALAVAILABILITY DOUBLE,
  LOWERREGACTUALAVAILABILITY DOUBLE,
  LORSURPLUS DOUBLE,
  LRCSURPLUS DOUBLE,
  file VARCHAR,
  SETTLEMENTDATE TIMESTAMP,
  DATE DATE,
  YEAR INT
);

-- ----------------------------------------------------------------------------
-- INTRADAY SCADA DATA (5-minute intervals)
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS scada_today (
  DUID VARCHAR,
  INITIALMW DOUBLE,
  file VARCHAR,
  SETTLEMENTDATE TIMESTAMP,
  LASTCHANGED TIMESTAMP,
  DATE DATE,
  YEAR INT
);

-- ----------------------------------------------------------------------------
-- INTRADAY PRICE DATA (5-minute intervals)
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS price_today (
  REGIONID VARCHAR,
  RUNNO DOUBLE,
  DISPATCHINTERVAL DOUBLE,
  INTERVENTION DOUBLE,
  RRP DOUBLE,
  EEP DOUBLE,
  ROP DOUBLE,
  APCFLAG DOUBLE,
  MARKETSUSPENDEDFLAG DOUBLE,
  RAISE6SECRRP DOUBLE,
  RAISE6SECROP DOUBLE,
  RAISE6SECAPCFLAG DOUBLE,
  RAISE60SECRRP DOUBLE,
  RAISE60SECROP DOUBLE,
  RAISE60SECAPCFLAG DOUBLE,
  RAISE5MINRRP DOUBLE,
  RAISE5MINROP DOUBLE,
  RAISE5MINAPCFLAG DOUBLE,
  RAISEREGRRP DOUBLE,
  RAISEREGROP DOUBLE,
  RAISEREGAPCFLAG DOUBLE,
  LOWER6SECRRP DOUBLE,
  LOWER6SECROP DOUBLE,
  LOWER6SECAPCFLAG DOUBLE,
  LOWER60SECRRP DOUBLE,
  LOWER60SECROP DOUBLE,
  LOWER60SECAPCFLAG DOUBLE,
  LOWER5MINRRP DOUBLE,
  LOWER5MINROP DOUBLE,
  LOWER5MINAPCFLAG DOUBLE,
  LOWERREGRRP DOUBLE,
  LOWERREGROP DOUBLE,
  LOWERREGAPCFLAG DOUBLE,
  PRE_AP_ENERGY_PRICE DOUBLE,
  PRE_AP_RAISE6_PRICE DOUBLE,
  PRE_AP_RAISE60_PRICE DOUBLE,
  PRE_AP_RAISE5MIN_PRICE DOUBLE,
  PRE_AP_RAISEREG_PRICE DOUBLE,
  PRE_AP_LOWER6_PRICE DOUBLE,
  PRE_AP_LOWER60_PRICE DOUBLE,
  PRE_AP_LOWER5MIN_PRICE DOUBLE,
  PRE_AP_LOWERREG_PRICE DOUBLE,
  RAISE1SECRRP DOUBLE,
  RAISE1SECROP DOUBLE,
  RAISE1SECAPCFLAG DOUBLE,
  LOWER1SECRRP DOUBLE,
  LOWER1SECROP DOUBLE,
  LOWER1SECAPCFLAG DOUBLE,
  PRE_AP_RAISE1_PRICE DOUBLE,
  PRE_AP_LOWER1_PRICE DOUBLE,
  CUMUL_PRE_AP_ENERGY_PRICE DOUBLE,
  CUMUL_PRE_AP_RAISE6_PRICE DOUBLE,
  CUMUL_PRE_AP_RAISE60_PRICE DOUBLE,
  CUMUL_PRE_AP_RAISE5MIN_PRICE DOUBLE,
  CUMUL_PRE_AP_RAISEREG_PRICE DOUBLE,
  CUMUL_PRE_AP_LOWER6_PRICE DOUBLE,
  CUMUL_PRE_AP_LOWER60_PRICE DOUBLE,
  CUMUL_PRE_AP_LOWER5MIN_PRICE DOUBLE,
  CUMUL_PRE_AP_LOWERREG_PRICE DOUBLE,
  CUMUL_PRE_AP_RAISE1_PRICE DOUBLE,
  CUMUL_PRE_AP_LOWER1_PRICE DOUBLE,
  SETTLEMENTDATE TIMESTAMP,
  DATE DATE,
  file VARCHAR,
  YEAR INT
);

-- ----------------------------------------------------------------------------
-- DIMENSION TABLES
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS summary (
  date DATE,
  "time" INT,
  cutoff TIMESTAMP,
  DUID VARCHAR,
  mw DECIMAL(18, 4),
  price DECIMAL(18, 4)
);

CREATE TABLE IF NOT EXISTS calendar (
  date DATE,
  year INT,
  month INT
);

CREATE TABLE IF NOT EXISTS duid (
  DUID VARCHAR,
  Region VARCHAR,
  FuelSourceDescriptor VARCHAR,
  Participant VARCHAR,
  State VARCHAR,
  latitude DOUBLE,
  longitude DOUBLE
);

-- ----------------------------------------------------------------------------
-- CSV ARCHIVE LOG (tracks raw files copied to Azure)
-- ----------------------------------------------------------------------------
CREATE TABLE IF NOT EXISTS csv_archive_log (
  source_type VARCHAR,       -- 'scada', 'price', 'scada_today', 'price_today', 'duid_*'
  source_filename VARCHAR,   -- parsed filename from URL
  archive_path VARCHAR,      -- relative path where written
  archived_at TIMESTAMP,
  row_count BIGINT,
  source_url VARCHAR,        -- original URL for reference data
  etag VARCHAR               -- HTTP ETag for change detection
);
